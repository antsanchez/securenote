<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secure Note + Tools</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: 2em auto;
      padding: 0 1em;
      box-sizing: border-box;
    }
    textarea, input {
      width: 100%;
      padding: 0.5em;
      margin: 0.5em 0;
      box-sizing: border-box;
    }
    textarea { height: 150px; }
    button { padding: 0.5em 1em; margin: 0.5em 0; }
    .output-box { word-break: break-word; white-space: pre-wrap; background: #f2f2f2; padding: 1em; min-height: 50px; }
    .tabs { border-bottom: 1px solid #ccc; margin-bottom: 0; }
    .tabs button { margin-right: 1em; background: #eee; border: 1px solid #ccc; border-bottom: none; cursor: pointer; padding: 0.5em 1em; }
    .tabs button.active { background: #fff; font-weight: bold; border-bottom: 1px solid #fff; }
    .tab-section { display: none; border: 1px solid #ccc; padding: 1.5em; margin-top: -1px; border-top: none; }
    .tab-section.active { display: block; background-color: #fff; }
    .info-text { font-size: 0.9em; color: #555; margin-bottom: 1em; }
    .security-notice { background-color: #eef; border-left: 4px solid #44d; padding: 1em; margin: 1.5em 0; font-size: 0.9em; }
    footer { margin-top: 2em; padding-top: 1em; border-top: 1px solid #ccc; text-align: center; font-size: 0.9em; color: #666; }
    footer a { margin: 0 0.5em; color: #333; text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    @media (max-width: 600px) {
      body {
        margin: 1em auto;
        padding: 0 0.5em;
      }
      h1 {
        font-size: 1.5em;
      }
      h2 {
        font-size: 1.2em;
      }
      button, .tabs button {
        padding: 0.6em 0.8em;
        font-size: 0.9em;
      }
      .tabs {
        border-bottom: none;
      }
      .tabs button {
        display: block;
        width: 100%;
        margin-right: 0;
        margin-bottom: 0.25em;
        border-bottom: 1px solid #ccc;
        text-align: center;
        box-sizing: border-box;
      }
      .tabs button.active {
         border-bottom: 1px solid #ccc;
         border-left: 4px solid #44d;
         padding-left: calc(0.8em - 4px);
      }
      .tab-section {
        padding: 1em;
        border-top: 1px solid #ccc;
        margin-top: 1em;
      }
      textarea {
        height: 120px;
      }
      .security-notice, .info-text, footer {
        font-size: 0.85em;
      }
    }
  </style>
</head>
<body>
  <h1>üîê Secure Note Utility</h1>
  <div class="tabs">
    <button id="btn-encrypt" onclick="switchTab('encrypt', this)" class="active">üîí Encrypt</button>
    <button id="btn-decrypt" onclick="switchTab('decrypt', this)">üîì Decrypt</button>
    <button id="btn-replace" onclick="switchTab('replace', this)">üîÅ Replace Characters</button>
  </div>

  <div class="security-notice">
    <strong>Security Assurance:</strong> All encryption and decryption operations happen entirely within your browser using the standard Web Crypto API (AES-GCM). Your passwords and messages are never sent to any server, ensuring maximum privacy and security. Remember to use a strong, unique password.
  </div>

  <div id="encrypt" class="tab-section active">
    <h2>Encrypt Message</h2>
    <p class="info-text">Enter your message and a password. The tool will encrypt your text using AES-GCM encryption. The output can only be decrypted with the correct password.</p>
    <textarea id="plainText" placeholder="Enter your secret message..."></textarea>
    <input type="password" id="encryptPassword" placeholder="Password">
    <button onclick="encryptNote()">Encrypt</button>
    <div class="output-box" id="encryptedOutput"></div>
  </div>

  <div id="decrypt" class="tab-section">
    <h2>Decrypt Message</h2>
    <p class="info-text">Paste the encrypted message (the long string of characters generated by the encrypt tool) and enter the original password to reveal the original text.</p>
    <textarea id="encryptedText" placeholder="Paste encrypted message here..."></textarea>
    <input type="password" id="decryptPassword" placeholder="Password">
    <button onclick="decryptNote()">Decrypt</button>
    <div class="output-box" id="decryptedOutput"></div>
  </div>

  <div id="replace" class="tab-section">
    <h2>Replace Characters</h2>
    <p class="info-text">Enter text and specify two single characters. The tool will swap every instance of the 'From' character with the 'To' character, and vice-versa, throughout the text.</p>
    <textarea id="replaceInput" placeholder="Enter text to modify..."></textarea>
    <input type="text" id="fromChar" maxlength="1" placeholder="From (e.g., a)">
    <input type="text" id="toChar" maxlength="1" placeholder="To (e.g., b)">
    <button onclick="replaceChars()">Replace</button>
    <div class="output-box" id="replaceOutput"></div>
  </div>

  <script>
    function switchTab(tabId, clickedButton) {
      document.querySelectorAll('.tab-section').forEach(sec => {
        sec.classList.remove('active');
      });
      document.querySelectorAll('.tabs button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(tabId).classList.add('active');
      clickedButton.classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', () => {
    });

    async function getKey(password, salt) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
      );
      return crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt,
          iterations: 100000,
          hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
    }

    async function encryptNote() {
      const plainText = document.getElementById('plainText').value;
      const password = document.getElementById('encryptPassword').value;
      const enc = new TextEncoder();
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const key = await getKey(password, salt);
      const cipherText = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv },
        key,
        enc.encode(plainText)
      );

      const data = {
        iv: Array.from(iv),
        salt: Array.from(salt),
        cipher: Array.from(new Uint8Array(cipherText))
      };

      document.getElementById('encryptedOutput').textContent = btoa(JSON.stringify(data));
    }

    async function decryptNote() {
      const encryptedText = document.getElementById('encryptedText').value;
      const password = document.getElementById('decryptPassword').value;
      try {
        const data = JSON.parse(atob(encryptedText));
        const iv = new Uint8Array(data.iv);
        const salt = new Uint8Array(data.salt);
        const cipher = new Uint8Array(data.cipher);
        const key = await getKey(password, salt);
        const decrypted = await crypto.subtle.decrypt(
          { name: "AES-GCM", iv },
          key,
          cipher
        );
        const dec = new TextDecoder();
        document.getElementById('decryptedOutput').textContent = dec.decode(decrypted);
      } catch (e) {
        document.getElementById('decryptedOutput').textContent = "‚ùå Decryption failed.";
      }
    }

    function replaceChars() {
        const input = document.getElementById('replaceInput').value;
        const from = document.getElementById('fromChar').value;
        const to = document.getElementById('toChar').value;

        if (from.length !== 1 || to.length !== 1) {
            alert("Please enter single characters to swap.");
            return;
        }

        const tempChar = '\u0001';
        const step1 = input.split(from).join(tempChar);
        const step2 = step1.split(to).join(from);
        const result = step2.split(tempChar).join(to);

        document.getElementById('replaceOutput').textContent = result;
    }

  </script>

  <footer>
    <a href="https://asanchez.dev" target="_blank" rel="noopener noreferrer">asanchez.dev</a> |
    <a href="https://asanchez.dev/site-notice/" target="_blank" rel="noopener noreferrer">Site Notice</a> |
    <a href="https://asanchez.dev/privacy/" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
  </footer>
</body>
</html>
